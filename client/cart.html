<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://kit.fontawesome.com/45823de667.js" crossorigin="anonymous"></script>
	<title>Cart</title>
	<link rel="stylesheet" type="text/css" href="./css/index.css">
	<link rel="stylesheet" type="text/css" href="./css/cart.css">
</head>
<body>
<div class="container">

	<!-- modal -->

		<div class="modal invisible" id="contentModal">
			<div class="modal--body">
				<div class="modal--image">
					<img id="imgModalDelete" src="./image/image.jpg">
				</div>
				<div class="modal--desc">
					<span class="modal--desc-exit" id="cancelDelete"><i class="fa-solid fa-xmark"></i></span>
					<p>Czy chcesz usunąć z koszyka ten produkt ?</p>
					<div>
						<a href="#" class="buttonBuy" id="deleteOrder" onclick="del()">Tak</a>
						<a href="#" class="buttonBuy" onclick="document.querySelector('#cancelDelete').click()">nie</a>
					</div>
				</div>
			</div>
		</div>

		<!-- modal end -->


		<div>
			<div class="topBar hideOnMobile">
				<div class="bar">
					<ul class="barList">
						<li><a class="buttonNavi" href="./index.html">Strona główna</a></li>
						<li><a class="buttonNavi hideFromNotUser" href="./historyOrder.html">Historia zamówień</a></li>
					</ul>
					<div class="logo">
						LOGO
					</div>
					<div class="menu">
						<div class="menu--item hideFromNotUser">
							<a href="./cart.html" class="menu--item-none active">
								<i class="fa-solid fa-bag-shopping fa-lg"></i>
								<p class="menu--item-option">Koszyk</p>
							</a>
						</div>
						<div class="menu--item login--triger" id="loginMenu" trigger="#loginModal">
							<a  class="menu--item-none " trigger="#loginModal">
								<i class="fa-solid fa-user fa-lg" trigger="#loginModal"></i>
								<p class="menu--item-option" trigger="#loginModal">Zaloguj</p>
							</a>
						</div>
						<div class="menu--item invisible" onclick="logout()" id="logoutMenu">
							<a href="#" class="menu--item-none">
								<i class="fa-solid fa-user fa-lg"></i>
								<p class="menu--item-option">Wyloguj</p>
							</a>
						</div>
						<div class="menu--item">
							<a id="search" href="#"  class="menu--item-none">
								<i class="fa-solid fa-magnifying-glass fa-lg"></i>
								<p class="menu--item-option">Szukaj</p>
							</a>
						</div>
					</div>
				</div>
				<div class="search invisible">
					<form action="./search.html" method="GET">
						<a id="searchGo"><span><i class="fa-solid fa-magnifying-glass fa-lg"></i></span></a>
						<input id="searchInput" type="text" name="string" class="searchInput" placeholder='Wpisz, czego szukasz, np. "czarny" lub "półbuty"'>
					</form>
				</div>
			</div>

			<label  class="hideOnScreen">
				<div class="mobileMenuIco" id="menuMobileButton">
					<i class="fa-solid fa-bars fa-xl"></i>
				</div>
			</label>

			<div class="topBarMobile menuMobileHide " id="menuMobile">

				<span class="menuMobile--exit" id="mobileExit"><i class="fa-solid fa-xmark fa-xl"></i></span>

				<div class="barMobile">
					<div class="logoMobile">
						LOGO
					</div>
					<ul class="barListMobile">
						<li><a class="buttonNavi" href="./index.html">Strona główna</a></li>
						<li><a class="buttonNavi hideFromNotUser" href="./historyOrder.html">Historia zamówień</a></li>
					</ul>
					<div class="menu">
						<div class="menu--item-mobile">
							<a href="./cart.html" class="menu--item-none hideFromNotUser active">
								<i class="fa-solid fa-bag-shopping fa-lg"></i>
								<p class="menu--item-option">Koszyk</p>
							</a>
						</div>
						<div class="menu--item-mobile " id="loginMenuMobile">
							<i class="fa-solid fa-user fa-lg"></i>
							<p class="menu--item-option">Zaloguj</p>
						</div>
						<div class="menu--item-mobile invisible" id="logoutMenuMobile">
							<i class="fa-solid fa-user fa-lg"></i>
							<p class="menu--item-option">Wyloguj</p>
						</div>
						<div class="menu--item-mobile">
							<i class="fa-solid fa-magnifying-glass fa-lg"></i>
							<p class="menu--item-option">Szukaj</p>
						</div>
					</div>

					<div class="search">
						<form>
							<span><i class="fa-solid fa-magnifying-glass fa-lg"></i></span>
							<input type="text" name="search" class="searchInput" placeholder='Wpisz, czego szukasz, np. "buty na jesień" lub "obuwie damskie'>
						</form>
					</div>
				</div>
			</div>

		</div>
<div class="modal invisible" id="loginModal">
			<div class="modal--body">
				<div class="loginDiv">
					<span class="modal--desc-exit"><i class="fa-solid fa-xmark"></i></span>
					
						<div class="bodyModalLogin">
							<div class="space">
								<input type="text" name="login" id="login" required>
								<label for="login">Login</label>
							</div>
							<div class="space">
								<input type="password" name="password" id="password" required>
								<label for="password">password</label>
							</div>
						</div>
						<button class="buttonBuy" id="loginButton" onclick="login.login()">Zaloguj</button>
					
				</div>
			</div>
		</div>
		<div class="content">

			<div class="products" id="productsCart">

				<!-- <div class="product">
					<div class="productContent">
						<img class="productImage" src="./image/img2.jpg">
					</div>
					<div class="productContent">
						<p>ADIDAS</p>
						<p>Obuwie sportowe ADIDAS STRUTTER GX0670 Biały</p>
					</div>
					<div class="productContent">
						<p>Ilość</p>
						<p>2 szt.</p>
					</div>
					<div class="productContent">
						<p>Cena łączna:</p>
						<p>499,98 zł</p>
					</div>
					<div class="productContent">
						<i class="fa-solid fa-trash-can modal--triger" trigger="#contentModal"></i>
					</div>
				</div>	 -->	

			</div>
			<div class="overview">
				<h1>Podsumowanie</h1>
				<div class="boxLine">
					<p class="boxDesc">Wartość produktów</p>
					<span class="boxPrice"><span id="priceOrder">0</span> zł</span>
				</div>
				<div class="boxLine">
					<p class="boxDesc">Koszt dostawy</p>
					<span class="boxPrice"><span id="priceShipment">0</span> zł</span>
				</div>
				<div class="boxLine">
					<p class="boxDesc">Suma</p>
					<span class="boxPrice"><span id="priceTotal">0</span> zł</span>
				</div>

				<a class="buttonBuy" onclick="isCartEmpty()" id="paymentGo">Przejdź do zapłaty</a>
			</div>

		</div>
	</div>

	<div class="footer">
		<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
		tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
		quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
		consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
		cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
		proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
	</div>
	<script type="text/javascript" src="./js/modal.js"></script>
	<script type="text/javascript" src="./js/cookie.js"></script>
	<script type="text/javascript" src="./js/auth.js"></script>
	<script type="text/javascript" src="./js/main.js"></script>
	<script type="text/javascript" src="./js/productsFetch.js"></script>
	<script type="text/javascript">

		window.cart = new Map();
		let modal = new Modal('.modal--triger');
		let product = new Product();
		
		window.priceTotal = 0;
		window.count = 0;

		function isCartEmpty(){
			let orderCookie = cookie.getCookie('order').split('|');
			if(orderCookie[0] == ""){
				alert("Musisz coś dodać do koszyka")
			}else{
				cookie.addCookie('cart', JSON.stringify([...window.cart.entries()]))
				window.location.replace('./purchase.html');
			}
		}

		function isEmptyStage(){
			let orderCookie = cookie.getCookie('order').split('|');
			if(orderCookie[0] == ''){
				document.querySelector("#productsCart").innerHTML +=`
					<h3 style="text-align: right;">Twój koszyk jest pusty</h3>
				`

				document.querySelector('.overview').classList.toggle('invisible')
			}
		}

		isEmptyStage()
		let orderCookie = cookie.getCookie('order').split('|');
		for(let id of orderCookie){

			if(id != ''){
					product.one(id, product => {
					window.priceTotal += product.price
					window.count++
					document.querySelector("#priceOrder").innerHTML = window.priceTotal;
					document.querySelector("#priceShipment").innerHTML = window.count * 10;
					document.querySelector("#priceTotal").innerHTML = window.count * 10 + window.priceTotal;

					window.cart.set(product.id+'', 1)

					document.querySelector("#productsCart").innerHTML +=`
						<div class="product" id="productDel${product.id}">
							<div class="productContent">
								<img class="productImage" src="./image/${product.images.split(',')[0]}">
							</div>
							<div class="productContent">
								<p>${product.brand}</p>
								<p>${product.name}</p>
							</div>
							<div class="productContent">
								<p>Ilość</p>
								<p><span id="countProduct">1</span> szt.</p>
								<div><button onClick="cartManage(${product.id}, 1, ${product.price})">+</button><button onClick="cartManage(${product.id}, -1, ${product.price})">-</button></div>
							</div>
							<div class="productContent">
								<p>Cena:</p>
								<p><span class="priceProductCart">${product.price}</span> zł</p>
							</div>
							<div class="productContent">
								<i class="fa-solid fa-trash-can modal--triger" trigger="#contentModal" id="delete${product.id}" onClick="window.orderDelId=${product.id};document.querySelector('#imgModalDelete').setAttribute('src', './image/${product.images.split(',')[0]}')"></i>
							</div>
						</div>
					`
					modal.init();
				})
			}
		}
		function del(){
			
			let cookies = cookie.getCookie('order').split('|');
			let price = document.querySelector(`#productDel${window.orderDelId}`).querySelector('.priceProductCart').innerHTML
			window.priceTotal -= Number(price);
			window.count--;
			cookies.splice(cookies.indexOf(window.orderDelId+''),1);
			document.querySelector(`#productDel${window.orderDelId}`).remove();
			cookie.deleteCookie('order');
			cookie.addCookie('order', cookies.join("|"))
			modal.modalHide();
			document.querySelector("#priceOrder").innerHTML = window.priceTotal;
			document.querySelector("#priceShipment").innerHTML = window.count * 10;
			document.querySelector("#priceTotal").innerHTML = window.count * 10 + window.priceTotal;
			isEmptyStage()
		}

		function cartManage(id, value, price){
			if(value > 0){
				window.cart.set(id+'', window.cart.get(id+'')+value)

				window.priceTotal += price;
				window.count++;

				document.querySelector("#countProduct").innerHTML = Number(document.querySelector("#countProduct").innerHTML)+1;
				document.querySelector("#priceOrder").innerHTML = window.priceTotal;
				document.querySelector("#priceShipment").innerHTML = window.count * 10;
				document.querySelector("#priceTotal").innerHTML = window.count * 10 + window.priceTotal;
			}else if(value < 0){
				if(Number(document.querySelector("#countProduct").innerHTML) == 1){
					document.querySelector('#delete'+id).click()
				}else{
					window.cart.set(id+'', Number(window.cart.get(id+''))+value);

					window.priceTotal -= price;
					window.count--;

					document.querySelector("#countProduct").innerHTML = Number(document.querySelector("#countProduct").innerHTML)-1;
					document.querySelector("#priceOrder").innerHTML = window.priceTotal;
					document.querySelector("#priceShipment").innerHTML = window.count * 10;
					document.querySelector("#priceTotal").innerHTML = window.count * 10 + window.priceTotal;
				}

				
			}
		}
	</script>
</body>
</html>